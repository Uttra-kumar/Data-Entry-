<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Entry Software</title>
    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- FileSaver.js for Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <!-- jsPDF for PDF Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- SheetJS for Excel Export -->
    <script type="text/javascript" src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
        <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4361ee">
    <style>
        /* --- Glassmorphism Style --- */
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #74ABE2, #5563DE);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        
        h1 {
            color: #fff;
            margin-top: 20px;
            text-shadow: 1px 1px 5px rgba(0, 0, 0, 0.3);
        }
        a{
            text-decoration: none;
            color: #FFFFFF;
        }
        .form-container,
        .table-container {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 20px;
            margin: 20px;
            width: 90%;
            max-width: 800px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            transition: 0.3s all;
        }
        
        .form-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 48px 0 rgba(31, 38, 135, 0.5);
        }
        
        input,
        button {
            padding: 10px;
            margin: 10px 5px;
            border-radius: 10px;
            border: none;
            
            outline: none;
        }
        
        input {
            width: calc(100% - 30px);
            background: rgba(255, 255, 255, 0.25);
            color: #000;
            backdrop-filter: blur(5px);
            font-weight: bold;
        }
        
        button {
            cursor: pointer;
            background: #5563DE;
            color: #fff;
            transition: 0.3s all;
        }
        
        button:hover {
            background: #74ABE2;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            color: #fff;
            text-align: left;
            font-size: 14px;
        }
        
        th,
        td {
            padding: 10px;
        }
        
        th {
            border-bottom: 2px solid rgba(255, 255, 255, 0.5);
        }
        
        tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .action-btn {
            margin-right: 5px;
            padding: 5px 8px;
            border-radius: 5px;
            font-size: 12px;
        }
        
        .edit-btn {
            background: #f1c40f;
            color: #000;
        }
        
        .delete-btn {
            background: #e74c3c;
        }
        
        .export-btn {
            background: #2ecc71;
            margin: 5px;
        }
    </style>
</head>

<body>
    
    <h1><a href="soft1.html">Data Entry Software</a></h1>
    <h1><a href="tnm.html">Billings<i class="fa fa-arrow-right"></i>
</a></h1>
    <div class="form-container">
        <h2>Add / Edit Data</h2>
        <input type="hidden" id="recordId" value="">
        <input type="text" id="name" placeholder="Name" required>
        <input type="text" id="mobile" placeholder="Mobile" required>
        <button id="submitBtn">Add Data</button>
    </div>
    
    <div class="table-container">
        <h2>All Records</h2>
        <div>
            <button class="export-btn" onclick="exportExcel()">Export Excel</button>
            <button class="export-btn" onclick="exportText()">Export Text</button>
            <button class="export-btn" onclick="exportPDF()">Export PDF</button>
        </div>
        <table id="dataTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Mobile</th>
                    <th>Created At</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Data will appear here -->
            </tbody>
        </table>
    </div>
    
    <script>
        // --- Supabase Setup ---
        const supabaseUrl = 'https://iydamvrlxtwsnqvflaxq.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml5ZGFtdnJseHR3c25xdmZsYXhxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwOTczMTIsImV4cCI6MjA3MzY3MzMxMn0.Z8m6XGyu9wsN_UJ8EZYr12BRemsO12_U8EEZ9JizQ6w';
        const client = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        // --- Elements ---
        const nameInput = document.getElementById('name');
        const mobileInput = document.getElementById('mobile');
        const submitBtn = document.getElementById('submitBtn');
        const recordId = document.getElementById('recordId');
        const dataTable = document.getElementById('dataTable').querySelector('tbody');
        
        // --- Load Data ---
        async function loadData() {
            let { data, error } = await client
                .from('Excel')
                .select('*')
                .order('id', { ascending: true });
            if (error) return console.error(error);
            dataTable.innerHTML = '';
            data.forEach(item => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                <td>${item.id}</td>
                <td>${item.name}</td>
                <td>${item.mobile}</td>
                <td>${new Date(item.created_at).toLocaleString()}</td>
                <td>
                    <button class="action-btn edit-btn" onclick="editRecord(${item.id})">Edit</button>
                    <button class="action-btn delete-btn" onclick="deleteRecord(${item.id})">Delete</button>
                </td>
            `;
                dataTable.appendChild(tr);
            });
        }
        
        // --- Add / Update Data ---
        submitBtn.addEventListener('click', async () => {
            const name = nameInput.value.trim();
            const mobile = mobileInput.value.trim();
            if (!name || !mobile) return alert('Please fill all fields!');
            const now = new Date().toISOString();
            
            if (recordId.value) {
                // Update
                const { error } = await client
                    .from('Excel')
                    .update({ name, mobile })
                    .eq('id', recordId.value);
                if (error) return console.error(error);
                recordId.value = '';
                submitBtn.textContent = 'Add Data';
            } else {
                // Insert
                const { error } = await client
                    .from('Excel')
                    .insert([{ name, mobile, created_at: now }]);
                if (error) return console.error(error);
            }
            nameInput.value = '';
            mobileInput.value = '';
            loadData();
        });
        
        // --- Edit Record ---
        async function editRecord(id) {
            const { data, error } = await client
                .from('Excel')
                .select('*')
                .eq('id', id)
                .single();
            if (error) return console.error(error);
            nameInput.value = data.name;
            mobileInput.value = data.mobile;
            recordId.value = data.id;
            submitBtn.textContent = 'Update Data';
        }
        
        // --- Delete Record ---
        async function deleteRecord(id) {
            if (!confirm('Are you sure?')) return;
            const { error } = await client
                .from('Excel')
                .delete()
                .eq('id', id);
            if (error) return console.error(error);
            loadData();
        }
        
        // --- Export Functions ---
        function exportExcel() {
            // Create a new workbook
            const wb = XLSX.utils.book_new();
            
            // Prepare data array
            const ws_data = [
                ["ID", "Name", "Mobile", "Created At"]
            ];
            [...dataTable.rows].forEach(row => {
                ws_data.push([...row.cells].slice(0, 4).map(c => c.textContent));
            });
            
            // Convert array to worksheet
            const ws = XLSX.utils.aoa_to_sheet(ws_data);
            
            // Append worksheet to workbook
            XLSX.utils.book_append_sheet(wb, ws, "Records");
            
            // Save as Excel file
            XLSX.writeFile(wb, "data.xlsx");
        }
        
        
        
        function exportText() {
            let txtContent = '';
            [...dataTable.rows].forEach(row => {
                txtContent += [...row.cells].slice(0, 4).map(c => c.textContent).join(' | ') + '\n';
            });
            const blob = new Blob([txtContent], { type: "text/plain;charset=utf-8" });
            saveAs(blob, "data.txt");
        }
        
        function exportPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            let y = 10;
            [...dataTable.rows].forEach(row => {
                doc.text([...row.cells].slice(0, 4).map(c => c.textContent).join(' | '), 10, y);
                y += 10;
            });
            doc.save('data.pdf');
        }
        
        // --- Initial Load ---
        loadData();
    </script>
    
</body>

</html>
